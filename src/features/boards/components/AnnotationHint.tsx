import { Box } from "@mantine/core";
import { useId } from "@mantine/hooks";
import type { Color, Square } from "chessops";
import type { JSX } from "react";
import { annotationColors, type Annotation } from "@/utils/annotation";
import { squareToCoordinates } from "@/utils/chessops";

export default function AnnotationHint({
  square,
  annotation,
  orientation,
}: {
  square: Square;
  annotation: Annotation;
  orientation: Color;
}) {
  const shadowFilterId = useId();
  const { file, rank } = squareToCoordinates(square, orientation);
  const color = annotationColors[annotation] || "#6B7280";

  return (
    <Box
      style={{
        position: "absolute",
        width: "12.5%",
        height: "12.5%",
        left: `${(file - 1) * 12.5}%`,
        bottom: `${(rank - 1) * 12.5}%`,
      }}
    >
      <Box pl="90%">
        {
          <Box
            style={{
              transform: "translateY(-40%) translateX(-50%)",
              zIndex: 100,
              filter: "url(#shadow)",
              overflow: "initial",
              borderRadius: "50%",
            }}
            w="45%"
            h="45%"
            pos="absolute"
            bg={color}
            variant="filled"
          >
            <svg viewBox="0 0 100 100">
              <title>{annotation}</title>
              <defs>
                <filter id={shadowFilterId}>
                  <feDropShadow dx="0" dy="1" floodOpacity="0.3" stdDeviation="0" />
                </filter>
              </defs>
              <g>{glyphToSvg[annotation]}</g>
            </svg>
          </Box>
        }
      </Box>
    </Box>
  );
}

// taken from lichess https://github.com/lichess-org/lila/blob/b7d9abb9f624b1525804aeb49a5b2678f23aae09/ui/analyse/src/glyphs.ts#L49C1-L85
const glyphToSvg: Record<Annotation, JSX.Element> = {
  "": <></>,
  "!": (
    <>
      <path
        fill="#fff"
        d="M54.967 62.349h-9.75l-2.049-39.083h13.847zM43.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z"
      />
    </>
  ),
  "!!": (
    <>
      <path
        fill="#fff"
        d="M71.967 62.349h-9.75l-2.049-39.083h13.847zM60.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244zM37.967 62.349h-9.75l-2.049-39.083h13.847zM26.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z"
      />
    </>
  ),
  "?": (
    <>
      <path
        fill="#fff"
        d="M40.436 60.851q0-4.66 1.957-7.83 1.958-3.17 6.712-6.619 4.195-2.983 5.967-5.127 1.864-2.237 1.864-5.22 0-2.983-2.237-4.475-2.144-1.585-6.06-1.585-3.915 0-7.737 1.212t-7.83 3.263l-4.941-9.975q4.568-2.517 9.881-4.101 5.314-1.585 11.653-1.585 9.695 0 15.008 4.661 5.407 4.661 5.407 11.839 0 3.822-1.212 6.619-1.212 2.796-3.635 5.22-2.424 2.33-6.06 5.034-2.703 1.958-4.195 3.356-1.491 1.398-2.05 2.703-.467 1.305-.467 3.263v2.703H40.436zm-1.492 18.924q0-4.288 2.33-5.966 2.331-1.771 5.687-1.771 3.263 0 5.594 1.771 2.33 1.678 2.33 5.966 0 4.102-2.33 5.966-2.331 1.772-5.594 1.772-3.356 0-5.686-1.772-2.33-1.864-2.33-5.966z"
      />
    </>
  ),
  "??": (
    <>
      <path
        fill="#fff"
        d="M31.8 22.22c-3.675 0-7.052.46-10.132 1.38-3.08.918-5.945 2.106-8.593 3.565l4.298 8.674c2.323-1.189 4.592-2.136 6.808-2.838a22.138 22.138 0 0 1 6.728-1.053c2.27 0 4.025.46 5.268 1.378 1.297.865 1.946 2.16 1.946 3.89s-.541 3.242-1.622 4.539c-1.027 1.243-2.756 2.73-5.188 4.458-2.756 2-4.7 3.918-5.836 5.755-1.134 1.837-1.702 4.107-1.702 6.808v2.92h10.457v-2.35c0-1.135.135-2.082.406-2.839.324-.756.918-1.54 1.783-2.35.864-.81 2.079-1.784 3.646-2.918 2.107-1.568 3.863-3.026 5.268-4.376 1.405-1.405 2.46-2.92 3.162-4.541.703-1.621 1.054-3.54 1.054-5.755 0-4.161-1.568-7.592-4.702-10.294-3.08-2.702-7.43-4.052-13.05-4.052zm38.664 0c-3.675 0-7.053.46-10.133 1.38-3.08.918-5.944 2.106-8.591 3.565l4.295 8.674c2.324-1.189 4.593-2.136 6.808-2.838a22.138 22.138 0 0 1 6.728-1.053c2.27 0 4.026.46 5.269 1.378 1.297.865 1.946 2.16 1.946 3.89s-.54 3.242-1.62 4.539c-1.027 1.243-2.757 2.73-5.189 4.458-2.756 2-4.7 3.918-5.835 5.755-1.135 1.837-1.703 4.107-1.703 6.808v2.92h10.457v-2.35c0-1.135.134-2.082.404-2.839.324-.756.918-1.54 1.783-2.35.865-.81 2.081-1.784 3.648-2.918 2.108-1.568 3.864-3.026 5.269-4.376 1.405-1.405 2.46-2.92 3.162-4.541.702-1.621 1.053-3.54 1.053-5.755 0-4.161-1.567-7.592-4.702-10.294-3.08-2.702-7.43-4.052-13.05-4.052zM29.449 68.504c-1.945 0-3.593.513-4.944 1.54-1.351.973-2.027 2.703-2.027 5.188 0 2.378.676 4.108 2.027 5.188 1.35 1.027 3 1.54 4.944 1.54 1.892 0 3.512-.513 4.863-1.54 1.35-1.08 2.026-2.81 2.026-5.188 0-2.485-.675-4.215-2.026-5.188-1.351-1.027-2.971-1.54-4.863-1.54zm38.663 0c-1.945 0-3.592.513-4.943 1.54-1.35.973-2.026 2.703-2.026 5.188 0 2.378.675 4.108 2.026 5.188 1.351 1.027 2.998 1.54 4.943 1.54 1.891 0 3.513-.513 4.864-1.54 1.351-1.08 2.027-2.81 2.027-5.188 0-2.485-.676-4.215-2.027-5.188-1.35-1.027-2.973-1.54-4.864-1.54z"
      />
    </>
  ),
  "!?": (
    <>
      <path
        fill="#fff"
        d="M60.823 58.9q0-4.098 1.72-6.883 1.721-2.786 5.9-5.818 3.687-2.622 5.243-4.506 1.64-1.966 1.64-4.588t-1.967-3.933q-1.885-1.393-5.326-1.393t-6.8 1.065q-3.36 1.065-6.883 2.868l-4.343-8.767q4.015-2.212 8.685-3.605 4.67-1.393 10.242-1.393 8.521 0 13.192 4.097 4.752 4.096 4.752 10.405 0 3.36-1.065 5.818-1.066 2.458-3.196 4.588-2.13 2.048-5.326 4.424-2.376 1.72-3.687 2.95-1.31 1.229-1.802 2.376-.41 1.147-.41 2.868v2.376h-10.57zm-1.311 16.632q0-3.77 2.048-5.244 2.049-1.557 4.998-1.557 2.868 0 4.916 1.557 2.049 1.475 2.049 5.244 0 3.605-2.049 5.244-2.048 1.556-4.916 1.556-2.95 0-4.998-1.556-2.048-1.64-2.048-5.244zM36.967 61.849h-9.75l-2.049-39.083h13.847zM25.004 75.532q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z"
      />
    </>
  ),
  "?!": (
    <>
      <path
        fill="#fff"
        d="M37.734 21.947c-3.714 0-7.128.464-10.242 1.393-3.113.928-6.009 2.13-8.685 3.605l4.343 8.766c2.35-1.202 4.644-2.157 6.883-2.867a22.366 22.366 0 0 1 6.799-1.065c2.294 0 4.07.464 5.326 1.393 1.311.874 1.967 2.186 1.967 3.933 0 1.748-.546 3.277-1.639 4.588-1.038 1.257-2.786 2.758-5.244 4.506-2.786 2.021-4.751 3.961-5.898 5.819-1.147 1.857-1.721 4.15-1.721 6.88v2.952h10.568v-2.377c0-1.147.137-2.103.41-2.868.328-.764.93-1.557 1.803-2.376.874-.82 2.104-1.803 3.688-2.95 2.13-1.584 3.906-3.058 5.326-4.424 1.42-1.42 2.485-2.95 3.195-4.59.71-1.638 1.065-3.576 1.065-5.816 0-4.206-1.584-7.675-4.752-10.406-3.114-2.731-7.51-4.096-13.192-4.096zm24.745.819l2.048 39.084h9.75l2.047-39.084zM35.357 68.73c-1.966 0-3.632.52-4.998 1.557-1.365.983-2.047 2.732-2.047 5.244 0 2.404.682 4.152 2.047 5.244 1.366 1.038 3.032 1.557 4.998 1.557 1.912 0 3.55-.519 4.916-1.557 1.366-1.092 2.05-2.84 2.05-5.244 0-2.512-.684-4.26-2.05-5.244-1.365-1.038-3.004-1.557-4.916-1.557zm34.004 0c-1.966 0-3.632.52-4.998 1.557-1.365.983-2.049 2.732-2.049 5.244 0 2.404.684 4.152 2.05 5.244 1.365 1.038 3.03 1.557 4.997 1.557 1.912 0 3.55-.519 4.916-1.557 1.366-1.092 2.047-2.84 2.047-5.244 0-2.512-.681-4.26-2.047-5.244-1.365-1.038-3.004-1.557-4.916-1.557z"
      />
    </>
  ),
  "+-": (
    <>
      <path
        fill="#fff"
        d="M 37.759 47.468 L 50.152 47.468 L 50.152 52.683 L 37.759 52.683 L 37.759 67.872 L 32.469 67.872 L 32.469 52.683 L 20 52.683 L 20 47.468 L 32.469 47.468 L 32.469 32.128 L 37.759 32.128 L 37.759 47.468 Z M 62.846 59.408 L 62.846 53.363 L 80 53.363 L 80 59.408 L 62.846 59.408 Z"
      />
    </>
  ),
  "±": (
    <>
      <path
        fill="#fff"
        d="M 53.477 40.166 L 69.768 40.166 L 69.768 47.02 L 53.477 47.02 L 53.477 67.086 L 46.523 67.086 L 46.523 47.02 L 30.132 47.02 L 30.132 40.166 L 46.523 40.166 L 46.523 20 L 53.477 20 L 53.477 40.166 Z M 30.132 80 L 30.132 73.146 L 69.868 73.146 L 69.868 80 L 30.132 80 Z"
      />
    </>
  ),
  "⩲": (
    <>
      <path
        fill="#fff"
        d="M 47.15 58.311 L 47.15 41.926 L 31.398 41.926 L 31.398 36.306 L 47.15 36.306 L 47.15 20 L 52.85 20 L 52.85 36.306 L 68.602 36.306 L 68.602 41.926 L 52.85 41.926 L 52.85 58.311 L 47.15 58.311 Z M 31.398 67.335 L 31.398 61.715 L 68.602 61.715 L 68.602 67.335 L 31.398 67.335 Z M 31.398 80 L 31.398 74.38 L 68.602 74.38 L 68.602 80 L 31.398 80 Z"
      />
    </>
  ),
  "=": (
    <>
      <path
        fill="#fff"
        d="M 20 39.367 L 20 28.886 L 80 28.886 L 80 39.367 L 20 39.367 Z M 20 71.114 L 20 60.633 L 80 60.633 L 80 71.114 L 20 71.114 Z"
      />
    </>
  ),
  "∞": (
    <>
      <path
        fill="#fff"
        d="M 65.306 68.132 C 62.418 68.132 59.608 67.221 56.876 65.4 C 54.145 63.579 51.648 60.659 49.388 56.641 C 47.441 60.283 45.243 63.061 42.794 64.977 C 40.345 66.892 37.582 67.849 34.505 67.849 C 31.805 67.849 29.356 67.127 27.159 65.683 C 24.961 64.239 23.218 62.182 21.931 59.514 C 20.644 56.845 20 53.689 20 50.047 C 20 46.593 20.612 43.501 21.837 40.77 C 23.061 38.038 24.788 35.871 27.018 34.271 C 29.247 32.669 31.837 31.868 34.788 31.868 C 37.677 31.868 40.502 32.732 43.265 34.459 C 46.028 36.185 48.477 39.058 50.612 43.077 C 52.559 39.435 54.741 36.703 57.159 34.882 C 59.576 33.061 62.323 32.151 65.4 32.151 C 69.733 32.151 73.25 33.783 75.95 37.049 C 78.65 40.314 80 44.553 80 49.765 C 80 53.218 79.388 56.327 78.164 59.089 C 76.939 61.852 75.228 64.05 73.03 65.683 C 70.832 67.316 68.257 68.132 65.306 68.132 Z M 34.694 61.538 C 37.017 61.538 39.105 60.581 40.958 58.666 C 42.81 56.751 44.615 53.815 46.374 49.859 C 44.804 45.965 43.093 43.046 41.241 41.099 C 39.388 39.152 37.268 38.179 34.882 38.179 C 32.182 38.179 30.047 39.341 28.477 41.664 C 26.907 43.987 26.122 46.782 26.122 50.047 C 26.122 53.124 26.86 55.809 28.336 58.101 C 29.812 60.393 31.931 61.538 34.694 61.538 Z M 65.024 61.821 C 67.786 61.821 69.969 60.675 71.57 58.384 C 73.171 56.091 73.972 53.344 73.972 50.141 C 73.972 46.813 73.155 44.035 71.523 41.806 C 69.89 39.576 67.755 38.462 65.118 38.462 C 62.857 38.462 60.832 39.419 59.043 41.335 C 57.253 43.25 55.447 46.185 53.626 50.141 C 55.259 54.035 56.986 56.954 58.807 58.901 C 60.628 60.848 62.7 61.821 65.024 61.821 Z"
      />
    </>
  ),
  "⩱": (
    <>
      <path
        fill="#fff"
        d="M 31.398 25.62 L 31.398 20 L 68.602 20 L 68.602 25.62 L 31.398 25.62 Z M 31.398 38.285 L 31.398 32.665 L 68.602 32.665 L 68.602 38.285 L 31.398 38.285 Z M 31.398 63.694 L 31.398 58.074 L 47.15 58.074 L 47.15 41.689 L 52.85 41.689 L 52.85 58.074 L 68.602 58.074 L 68.602 63.694 L 52.85 63.694 L 52.85 80 L 47.15 80 L 47.15 63.694 L 31.398 63.694 Z"
      />
    </>
  ),
  "∓": (
    <>
      <path
        fill="#fff"
        d="M 26.421 27.124 L 26.421 20 L 73.579 20 L 73.579 27.124 L 26.421 27.124 Z M 46.388 80 L 46.388 59.231 L 26.421 59.231 L 26.421 52.107 L 46.388 52.107 L 46.388 31.438 L 53.612 31.438 L 53.612 52.107 L 73.579 52.107 L 73.579 59.231 L 53.612 59.231 L 53.612 80 L 46.388 80 Z"
      />
    </>
  ),
  "-+": (
    <>
      <path
        fill="#fff"
        d="M 20 60.29 L 20 53.678 L 38.761 53.678 L 38.761 60.29 L 20 60.29 Z M 66.446 47.231 L 80 47.231 L 80 52.934 L 66.446 52.934 L 66.446 69.546 L 60.66 69.546 L 60.66 52.934 L 47.024 52.934 L 47.024 47.231 L 60.66 47.231 L 60.66 30.454 L 66.446 30.454 L 66.446 47.231 Z"
      />
    </>
  ),
  N: (
    <>
      <path
        fill="#fff"
        d="M 69.622 80 L 60.966 80 L 37.017 30.84 L 36.681 30.84 C 36.793 33.025 36.905 35.266 37.017 37.563 C 37.129 39.86 37.185 42.073 37.185 44.202 L 37.185 80 L 30.378 80 L 30.378 20 L 39.034 20 L 62.983 68.571 L 63.235 68.571 C 63.123 66.443 63.025 64.188 62.941 61.807 C 62.857 59.426 62.815 57.255 62.815 55.294 L 62.815 20 L 69.622 20 L 69.622 80 Z"
      />
    </>
  ),
  Best: (
    <>
      <path
        fill="#fff"
        d="M 50 15 L 55.9 38.1 L 80 38.1 L 60.5 52.4 L 66.4 75.5 L 50 61.2 L 33.6 75.5 L 39.5 52.4 L 20 38.1 L 44.1 38.1 Z"
      />
    </>
  ),
} as const;
